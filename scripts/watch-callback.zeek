module CVE_2021_44228;

export { 

	redef enum Notice::Type += {
	    Attempt,
	    CallBack,
	};

	type ip_port: record {
		ip: addr;
		p:  port;
	};
	
} 

global track_callback: table[ip_port] of  conn_id  ; # &backend=Broker::MEMORY;

event new_connection(c: connection)
    {
	local resp=c$id$resp_h;
	local dport = c$id$resp_p;

	local a:ip_port=[$ip=resp, $p=dport];

	if (a in track_callback)
	{
		NOTICE([$note=CallBack, $conn=c, $src=resp, $msg=fmt("Possible Successful Callback seen [%s:%s] : attack connection %s", resp,
			dport, track_callback[a]),$identifier=cat(c$id$orig_h),
			$suppress_for=30 mins]);
	}
    }

